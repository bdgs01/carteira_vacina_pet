<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Saúde Pet</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF para exportar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #f0fdf4 100%);
            min-height: 100vh;
        }
        
        .card-modern {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .card-modern:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #16a085, #27ae60);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(22, 160, 133, 0.3);
        }
        
        .input-modern {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.8);
        }
        
        .input-modern:focus {
            border-color: #16a085;
            box-shadow: 0 0 0 3px rgba(22, 160, 133, 0.1);
            outline: none;
        }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .tab {
            padding: 12px 24px;
            font-weight: 600;
            border-radius: 12px 12px 0 0;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #e0f2fe, #cffafe);
            border-bottom-color: #16a085;
            color: #0c4a6e;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-ok { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-future { background: #dbeafe; color: #1e40af; }
        .status-waiting { background: #f1f5f9; color: #475569; }
        
        .game-card {
            background: linear-gradient(135deg, #ffffff, #f8fafc);
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #16a085, #27ae60);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Tela de Setup Inicial -->
    <div id="setup-screen" class="hidden min-h-screen flex items-center justify-center p-6">
        <div class="w-full max-w-4xl card-modern p-8 rounded-2xl shadow-xl">
            <header class="text-center mb-8">
                <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-teal-500 to-green-500 rounded-full flex items-center justify-center">
                    <i class="ph-bold ph-paw-print text-3xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-slate-800">Bem-vindo ao Painel Pet</h1>
                <p class="text-slate-600 mt-2">Vamos configurar o perfil de saúde do seu companheiro</p>
            </header>
            
            <div id="setup-form" class="space-y-8">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Informações do Tutor -->
                    <div class="game-card p-6">
                        <h2 class="text-xl font-bold text-slate-700 mb-4 flex items-center">
                            <i class="ph-bold ph-user text-teal-600 mr-3"></i>
                            Suas Informações
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label for="tutor-nome" class="block text-sm font-semibold text-slate-700 mb-2">Nome Completo</label>
                                <input type="text" id="tutor-nome" class="input-modern w-full" placeholder="Digite seu nome">
                            </div>
                            <div>
                                <label for="tutor-genero" class="block text-sm font-semibold text-slate-700 mb-2">Pronome de tratamento</label>
                                <select id="tutor-genero" class="input-modern w-full">
                                    <option value="ela">Ela</option>
                                    <option value="ele">Ele</option>
                                    <option value="elu">Elu</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Informações do Pet -->
                    <div class="game-card p-6">
                        <h2 class="text-xl font-bold text-slate-700 mb-4 flex items-center">
                            <i class="ph-bold ph-heart text-pink-600 mr-3"></i>
                            Informações do Pet
                        </h2>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="flex-1">
                                    <label for="pet-foto" class="block text-sm font-semibold text-slate-700 mb-2">Foto</label>
                                    <input type="file" id="pet-foto" accept="image/*" class="input-modern w-full text-sm">
                                </div>
                                <div class="w-20 h-20 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center">
                                    <img id="foto-preview" src="https://via.placeholder.com/80x80/cbd5e1/64748b?text=Pet" alt="Preview" class="w-full h-full object-cover">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="pet-nome" class="block text-sm font-semibold text-slate-700 mb-2">Nome</label>
                                    <input type="text" id="pet-nome" class="input-modern w-full" placeholder="Nome do pet">
                                </div>
                                <div>
                                    <label for="pet-sexo" class="block text-sm font-semibold text-slate-700 mb-2">Sexo</label>
                                    <select id="pet-sexo" class="input-modern w-full">
                                        <option value="macho">Macho</option>
                                        <option value="fêmea">Fêmea</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label for="pet-apelidos" class="block text-sm font-semibold text-slate-700 mb-2">Apelidos (separados por vírgula)</label>
                                <input type="text" id="pet-apelidos" class="input-modern w-full" placeholder="Docinho, Princesa, etc.">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="pet-raca" class="block text-sm font-semibold text-slate-700 mb-2">Raça</label>
                                    <input type="text" id="pet-raca" class="input-modern w-full" placeholder="Ex: Golden Retriever">
                                </div>
                                <div>
                                    <label for="pet-nascimento" class="block text-sm font-semibold text-slate-700 mb-2">Nascimento</label>
                                    <input type="date" id="pet-nascimento" class="input-modern w-full">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button onclick="salvarSetupInicial()" class="btn-primary py-3 px-8 rounded-xl text-lg font-semibold">
                        Criar Painel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Painel Principal -->
    <div id="dashboard-screen" class="hidden container mx-auto p-6 max-w-7xl">
        <!-- Header -->
        <header class="card-modern p-6 rounded-2xl shadow-lg mb-8">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center">
                <div>
                    <h1 class="text-3xl font-bold text-slate-800">Painel de Saúde</h1>
                    <p id="dashboard-pet-nome" class="text-xl text-teal-600 font-semibold"></p>
                </div>
                <div class="flex items-center space-x-3 mt-4 lg:mt-0">
                    <button onclick="exportarPDF()" class="btn-primary py-2 px-4 rounded-lg flex items-center">
                        <i class="ph-bold ph-download-simple mr-2"></i>
                        Exportar PDF
                    </button>
                    <button onclick="resetarDados()" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg flex items-center transition-colors">
                        <i class="ph-bold ph-trash mr-2"></i>
                        Resetar
                    </button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Sidebar -->
            <aside class="lg:col-span-1 space-y-6">
                <!-- Perfil do Pet -->
                <div class="game-card p-6">
                    <div class="text-center">
                        <div class="relative inline-block mb-4">
                            <img id="perfil-pet-foto" src="https://via.placeholder.com/120x120/cbd5e1/64748b?text=Pet" alt="Pet" class="w-24 h-24 rounded-full object-cover border-4 border-white shadow-lg">
                            <div class="absolute -bottom-1 -right-1 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center">
                                <i class="ph-bold ph-check text-white text-sm"></i>
                            </div>
                        </div>
                        <h2 id="perfil-pet-nome" class="text-xl font-bold text-slate-800"></h2>
                        <p id="perfil-pet-raca" class="text-slate-600 text-sm"></p>
                        <p id="perfil-pet-idade" class="text-slate-500 text-xs bg-slate-100 px-3 py-1 rounded-full mt-2 inline-block"></p>
                    </div>
                </div>

                <!-- Progresso Geral -->
                <div class="game-card p-6">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center">
                        <i class="ph-bold ph-chart-line-up text-blue-600 mr-2"></i>
                        Progresso da Saúde
                    </h3>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-slate-600">Vacinas Básicas</span>
                                <span id="progresso-texto" class="font-semibold">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div id="progresso-barra" class="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dica do Dia -->
                <div class="game-card p-6 bg-gradient-to-br from-amber-50 to-orange-50">
                    <h3 class="font-bold text-amber-800 mb-3 flex items-center">
                        <i class="ph-bold ph-lightbulb text-amber-600 mr-2"></i>
                        Dica do Dia
                    </h3>
                    <p id="dica-texto" class="text-amber-700 text-sm"></p>
                </div>
            </aside>

            <!-- Conteúdo Principal -->
            <main class="lg:col-span-3">
                <div class="game-card">
                    <!-- Navegação -->
                    <nav class="border-b p-4">
                        <div class="flex space-x-1">
                            <button onclick="changeTab('vacinas')" class="tab active">
                                <i class="ph-bold ph-syringe mr-2"></i>
                                Vacinas
                            </button>
                            <button onclick="changeTab('informacoes')" class="tab text-slate-500">
                                <i class="ph-bold ph-gear mr-2"></i>
                                Configurações
                            </button>
                        </div>
                    </nav>

                    <!-- Conteúdo das Tabs -->
                    <div class="p-6">
                        <!-- Tab Vacinas -->
                        <div id="tab-vacinas" class="tab-content active">
                            <div class="mb-6">
                                <h3 class="text-xl font-bold text-slate-700 mb-2">Carteira de Vacinação</h3>
                                <p class="text-slate-600">Acompanhe o cronograma de vacinas <span id="pronome-pet">do seu pet</span></p>
                            </div>
                            <div id="tabela-vacinas"></div>
                        </div>

                        <!-- Tab Informações -->
                        <div id="tab-informacoes" class="tab-content">
                            <h3 class="text-xl font-bold text-slate-700 mb-6">Informações Adicionais</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="edit-pet-peso" class="block text-sm font-semibold text-slate-700 mb-2">Peso (kg)</label>
                                    <input type="number" step="0.1" id="edit-pet-peso" class="input-modern w-full" placeholder="5.2">
                                </div>
                                <div>
                                    <label for="edit-pet-cor" class="block text-sm font-semibold text-slate-700 mb-2">Cor</label>
                                    <input type="text" id="edit-pet-cor" class="input-modern w-full" placeholder="Dourado">
                                </div>
                                <div>
                                    <label for="edit-pet-rg" class="block text-sm font-semibold text-slate-700 mb-2">RG Pet</label>
                                    <input type="text" id="edit-pet-rg" class="input-modern w-full" placeholder="SP123456">
                                </div>
                                <div>
                                    <label for="edit-pet-comida" class="block text-sm font-semibold text-slate-700 mb-2">Comida Favorita</label>
                                    <input type="text" id="edit-pet-comida" class="input-modern w-full" placeholder="Ração premium">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="edit-pet-brinquedo" class="block text-sm font-semibold text-slate-700 mb-2">Brinquedo Favorito</label>
                                    <input type="text" id="edit-pet-brinquedo" class="input-modern w-full" placeholder="Bolinha de tênis">
                                </div>
                            </div>
                            <div class="mt-6">
                                <button onclick="salvarEdicoes()" class="btn-primary py-2 px-6 rounded-lg">
                                    Salvar Alterações
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Footer -->
        <footer class="mt-8 p-4 text-center text-sm text-slate-500 bg-white/50 rounded-lg">
            Este é um projeto experimental em desenvolvimento por Bruno Goulart, Amanda Andrade e Nonato Davi. Se você recebeu este projeto para testes é porque você é importante para nós.
        </footer>
        
        <!-- Container PDF oculto -->
        <div id="carteira-pdf-container" class="fixed -top-full opacity-0 pointer-events-none"></div>
    </div>

    <script>
        const DB_KEY = 'petHealthDashboardData_v5';
        
        // Sistema inteligente de gêneros
        const GENEROS = {
            tutor: {
                'ela': { pronome: 'ela', artigo: 'a', possessivo: 'sua' },
                'ele': { pronome: 'ele', artigo: 'o', possessivo: 'seu' },
                'elu': { pronome: 'elu', artigo: 'e', possessivo: 'sue' }
            },
            pet: {
                'macho': { pronome: 'ele', artigo: 'o', possessivo: 'seu' },
                'fêmea': { pronome: 'ela', artigo: 'a', possessivo: 'sua' }
            }
        };
        
        const vacinasDB = [
            { id: 'v10_d1', nome: 'V8 ou V10 (1ª Dose)', idadeMinimaDias: 45, essencial: true },
            { id: 'v10_d2', nome: 'V8 ou V10 (2ª Dose)', idadeMinimaDias: 75, depende: 'v10_d1', essencial: true },
            { id: 'v10_d3', nome: 'V8 ou V10 (3ª Dose)', idadeMinimaDias: 105, depende: 'v10_d2', essencial: true },
            { id: 'v10_reforco', nome: 'V8 ou V10 (Reforço Anual)', idadeMinimaDias: 365, anual: true },
            { id: 'antirrabica', nome: 'Antirrábica', idadeMinimaDias: 120, anual: true, essencial: true },
            { id: 'gripe_d1', nome: 'Gripe Canina (1ª Dose)', idadeMinimaDias: 60 },
            { id: 'gripe_d2', nome: 'Gripe Canina (2ª Dose)', idadeMinimaDias: 81, depende: 'gripe_d1' },
            { id: 'giardia_d1', nome: 'Giárdia (1ª Dose)', idadeMinimaDias: 60 },
            { id: 'giardia_d2', nome: 'Giárdia (2ª Dose)', idadeMinimaDias: 81, depende: 'giardia_d1' },
        ];
        
        const dicasTemplate = [
            "Mantenha sempre água fresca disponível",
            "Escove os dentes {pronome_pet} regularmente", 
            "Verifique as patinhas após os passeios",
            "Mantenha {possessivo_pet} peso ideal com exercícios",
            "Observe mudanças de comportamento",
            "Mantenha as vacinas em dia"
        ];
        
        let appData = {};
        let fotoBase64 = null;

        // Inicialização
        window.onload = function() {
            const data = localStorage.getItem(DB_KEY);
            if (data) {
                try {
                    appData = JSON.parse(data);
                    showDashboard();
                } catch(e) {
                    showSetup();
                }
            } else {
                showSetup();
            }
            
            const fotoInput = document.getElementById('pet-foto');
            if (fotoInput) {
                fotoInput.addEventListener('change', handleFotoChange);
            }
        };

        // Funções auxiliares inteligentes
        function getPronouns() {
            if (!appData.tutor || !appData.pet) return { tutor: GENEROS.tutor.ela, pet: GENEROS.pet.macho };
            
            return {
                tutor: GENEROS.tutor[appData.tutor.genero] || GENEROS.tutor.ela,
                pet: GENEROS.pet[appData.pet.sexo] || GENEROS.pet.macho
            };
        }
        
        function aplicarInteligencia() {
            const pronouns = getPronouns();
            
            // Atualiza pronomes do pet na interface
            const pronounElements = document.querySelectorAll('[id*="pronome"]');
            pronounElements.forEach(el => {
                if (el.id.includes('pet')) {
                    el.textContent = `${pronouns.pet.artigo} ${appData.pet?.nome || 'seu pet'}`;
                }
            });
        }

        function handleFotoChange(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fotoBase64 = e.target.result;
                    document.getElementById('foto-preview').src = fotoBase64;
                }
                reader.readAsDataURL(file);
            }
        }

        function showSetup() {
            document.getElementById('setup-screen').classList.remove('hidden');
            document.getElementById('dashboard-screen').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('dashboard-screen').classList.remove('hidden');
            renderDashboard();
        }

        function salvarSetupInicial() {
            const tutorNome = document.getElementById('tutor-nome').value.trim();
            const petNome = document.getElementById('pet-nome').value.trim();
            const petNascimento = document.getElementById('pet-nascimento').value;

            if (!tutorNome || !petNome || !petNascimento) {
                alert('Por favor, preencha pelo menos o nome, nome do pet e data de nascimento.');
                return;
            }

            appData = {
                tutor: { 
                    nome: tutorNome,
                    genero: document.getElementById('tutor-genero').value
                },
                pet: {
                    nome: petNome,
                    apelidos: document.getElementById('pet-apelidos').value.trim(),
                    sexo: document.getElementById('pet-sexo').value,
                    nascimento: petNascimento,
                    raca: document.getElementById('pet-raca').value.trim(),
                    foto: fotoBase64,
                    peso: '', cor: '', rg: '', comida: '', brinquedo: '',
                    vacinasTomadas: []
                }
            };
            
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
            showDashboard();
        }

        function renderDashboard() {
            if (!appData.pet) return;
            
            const { idadeEmDias, idadeString } = getPetIdade();
            
            // Aplica inteligência de gênero
            aplicarInteligencia();
            
            // Atualiza informações básicas
            document.getElementById('dashboard-pet-nome').textContent = appData.pet.nome;
            document.getElementById('perfil-pet-nome').textContent = appData.pet.nome;
            document.getElementById('perfil-pet-raca').textContent = appData.pet.raca || 'Raça não informada';
            document.getElementById('perfil-pet-idade').textContent = idadeString;
            
            const fotoUrl = appData.pet.foto || 'https://via.placeholder.com/120x120/cbd5e1/64748b?text=Pet';
            document.getElementById('perfil-pet-foto').src = fotoUrl;

            // Preenche campos de edição
            document.getElementById('edit-pet-peso').value = appData.pet.peso || '';
            document.getElementById('edit-pet-cor').value = appData.pet.cor || '';
            document.getElementById('edit-pet-rg').value = appData.pet.rg || '';
            document.getElementById('edit-pet-comida').value = appData.pet.comida || '';
            document.getElementById('edit-pet-brinquedo').value = appData.pet.brinquedo || '';

            renderTabelaVacinas(idadeEmDias);
            renderProgresso();
            renderDica();
        }

        function renderTabelaVacinas(idadeEmDias) {
            const container = document.getElementById('tabela-vacinas');
            let html = '<div class="space-y-4">';

            vacinasDB.forEach(vacina => {
                const { status, classe, data, elegivel } = getStatusVacina(vacina, idadeEmDias);
                const isChecked = appData.pet.vacinasTomadas.includes(vacina.id);
                
                html += `
                    <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-colors">
                        <div class="flex-1">
                            <h4 class="font-semibold text-slate-800">${vacina.nome}</h4>
                            <p class="text-sm text-slate-600">${data}</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="status-badge ${classe}">${status}</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" 
                                       value="${vacina.id}" 
                                       class="sr-only" 
                                       onchange="toggleVacina(this.value)" 
                                       ${isChecked ? 'checked' : ''} 
                                       ${!elegivel && !isChecked ? 'disabled' : ''}>
                                <div class="w-6 h-6 rounded-md border-2 flex items-center justify-center transition-colors ${isChecked ? 'bg-green-500 border-green-500' : 'border-slate-300'}">
                                    ${isChecked ? '<i class="ph-bold ph-check text-white text-sm"></i>' : ''}
                                </div>
                            </label>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function renderProgresso() {
            const vacinasEssenciais = vacinasDB.filter(v => v.essencial);
            const vacinasTomadas = vacinasEssenciais.filter(v => appData.pet.vacinasTomadas.includes(v.id));
            const progresso = Math.round((vacinasTomadas.length / vacinasEssenciais.length) * 100);
            
            document.getElementById('progresso-texto').textContent = `${progresso}%`;
            document.getElementById('progresso-barra').style.width = `${progresso}%`;
        }

        function renderDica() {
            const pronouns = getPronouns();
            const template = dicasTemplate[Math.floor(Math.random() * dicasTemplate.length)];
            
            const dica = template
                .replace('{pronome_pet}', pronouns.pet.pronome)
                .replace('{possessivo_pet}', pronouns.pet.possessivo);
            
            document.getElementById('dica-texto').textContent = dica;
        }

        function getPetIdade() {
            if (!appData.pet.nascimento) return { idadeEmDias: 0, idadeString: 'Idade não definida' };
            
            const hoje = new Date();
            const nascimento = new Date(appData.pet.nascimento);
            const diffTempo = Math.abs(hoje.getTime() - nascimento.getTime());
            const idadeEmDias = Math.ceil(diffTempo / (1000 * 3600 * 24));
            
            let idadeString;
            if (idadeEmDias < 30) {
                idadeString = `${idadeEmDias} dias`;
            } else if (idadeEmDias < 365) {
                const meses = Math.floor(idadeEmDias / 30);
                idadeString = `${meses} ${meses === 1 ? 'mês' : 'meses'}`;
            } else {
                const anos = Math.floor(idadeEmDias / 365);
                const meses = Math.floor((idadeEmDias % 365) / 30);
                idadeString = `${anos} ${anos === 1 ? 'ano' : 'anos'}${meses > 0 ? ` e ${meses} ${meses === 1 ? 'mês' : 'meses'}` : ''}`;
            }
            return { idadeEmDias, idadeString };
        }

        function getStatusVacina(vacina, idadePet) {
            const tomadas = new Set(appData.pet.vacinasTomadas);
            
            if (tomadas.has(vacina.id)) {
                return { status: 'Aplicada', classe: 'status-ok', data: 'Vacina aplicada', elegivel: true };
            }
            
            if (vacina.depende && !tomadas.has(vacina.depende)) {
                return { status: 'Aguardando', classe: 'status-waiting', data: 'Aguarda dose anterior', elegivel: false };
            }
            
            if (idadePet >= vacina.idadeMinimaDias) {
                return { status: 'Pendente', classe: 'status-pending', data: `Pode aplicar agora`, elegivel: true };
            } else {
                const diasRestantes = vacina.idadeMinimaDias - idadePet;
                return { status: 'Futura', classe: 'status-future', data: `Em ${diasRestantes} dias`, elegivel: false };
            }
        }

        function toggleVacina(vacinaId) {
            const index = appData.pet.vacinasTomadas.indexOf(vacinaId);
            if (index > -1) {
                appData.pet.vacinasTomadas.splice(index, 1);
            } else {
                appData.pet.vacinasTomadas.push(vacinaId);
            }
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
            renderDashboard();
        }

        function salvarEdicoes() {
            appData.pet.peso = document.getElementById('edit-pet-peso').value;
            appData.pet.cor = document.getElementById('edit-pet-cor').value;
            appData.pet.rg = document.getElementById('edit-pet-rg').value;
            appData.pet.comida = document.getElementById('edit-pet-comida').value;
            appData.pet.brinquedo = document.getElementById('edit-pet-brinquedo').value;
            
            localStorage.setItem(DB_KEY, JSON.stringify(appData));
            alert('Informações salvas com sucesso!');
            renderDashboard();
        }

        function resetarDados() {
            if (confirm('Tem certeza que deseja apagar todos os dados?')) {
                localStorage.removeItem(DB_KEY);
                window.location.reload();
            }
        }

        function changeTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => {
                el.classList.remove('active');
                el.classList.add('text-slate-500');
            });
            
            document.getElementById(`tab-${tabName}`).classList.add('active');
            const button = document.querySelector(`button[onclick="changeTab('${tabName}')"]`);
            button.classList.add('active');
            button.classList.remove('text-slate-500');
        }

        async function exportarPDF() {
            try {
                // Loading simples
                const originalText = event.target.textContent;
                event.target.textContent = 'Gerando...';
                event.target.disabled = true;
                
                const { jsPDF } = window.jspdf;
                const container = document.getElementById('carteira-pdf-container');
                const { idadeEmDias, idadeString } = getPetIdade();
                
                // Tabela de vacinas para PDF
                let tabelaVacinas = '';
                vacinasDB.forEach(vacina => {
                    const isChecked = appData.pet.vacinasTomadas.includes(vacina.id);
                    const status = isChecked ? 'Aplicada' : 'Pendente';
                    
                    tabelaVacinas += `
                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e5e7eb;">
                            <span>${vacina.nome}</span>
                            <span style="font-weight: bold;">${status}</span>
                        </div>
                    `;
                });
                
                const pdfContent = `
                    <div style="padding: 2rem; background: white; font-family: Inter, sans-serif; width: 800px;">
                        <div style="text-align: center; border-bottom: 2px solid #16a085; padding-bottom: 1rem; margin-bottom: 2rem;">
                            <h1 style="font-size: 2rem; font-weight: 800; color: #16a085;">Painel de Saúde Pet</h1>
                            <p style="font-size: 1.5rem; font-weight: 600;">${appData.pet.nome}</p>
                        </div>
                        
                        <div style="display: flex; gap: 2rem; margin-bottom: 2rem;">
                            <img src="${appData.pet.foto || 'https://via.placeholder.com/120x120/cbd5e1/64748b?text=Pet'}" 
                                 style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover;">
                            <div style="flex-grow: 1;">
                                <h2 style="font-size: 1.5rem; font-weight: 700;">${appData.pet.nome}</h2>
                                <p><strong>Tutor:</strong> ${appData.tutor.nome}</p>
                                <p><strong>Idade:</strong> ${idadeString}</p>
                                <p><strong>Raça:</strong> ${appData.pet.raca || 'N/A'}</p>
                                <p><strong>Sexo:</strong> ${appData.pet.sexo}</p>
                                ${appData.pet.peso ? `<p><strong>Peso:</strong> ${appData.pet.peso} kg</p>` : ''}
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem;">Carteira de Vacinação</h3>
                            ${tabelaVacinas}
                        </div>
                        
                        <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e5e7eb; text-align: center; font-size: 0.8rem; color: #6b7280;">
                            <p>Este é um projeto experimental em desenvolvimento por Bruno Goulart, Amanda Andrade e Nonato Davi. Se você recebeu este projeto para testes é porque você é importante para nós.</p>
                        </div>
                    </div>
                `;
                
                container.innerHTML = pdfContent;
                container.style.position = 'fixed';
                container.style.top = '0';
                container.style.left = '0';
                container.style.opacity = '1';
                container.style.zIndex = '-1000';
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const canvas = await html2canvas(container.querySelector('div'), { 
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });
                
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const ratio = canvas.width / canvas.height;
                
                let imgWidth = pdfWidth;
                let imgHeight = imgWidth / ratio;
                
                if (imgHeight > pdfHeight) {
                    imgHeight = pdfHeight;
                    imgWidth = imgHeight * ratio;
                }
                
                const x = (pdfWidth - imgWidth) / 2;
                const y = (pdfHeight - imgHeight) / 2;
                
                pdf.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
                pdf.save(`${appData.pet.nome}_painel_saude.pdf`);
                
                // Reset
                container.innerHTML = '';
                container.style.position = 'fixed';
                container.style.top = '-9999px';
                container.style.opacity = '0';
                
                event.target.textContent = originalText;
                event.target.disabled = false;
                
            } catch (error) {
                console.error('Erro:', error);
                event.target.textContent = originalText;
                event.target.disabled = false;
                alert('Erro ao gerar PDF. Tente novamente.');
            }
        }
    </script>
</body>
</html>
